#######################################################################
#
#   Copyright (c) 2016 Orange
#   valentin.boucher@orange.com
#
# All rights reserved. This program and the accompanying materials
# are made available under the terms of the Apache License, Version 2.0
# which accompanies this distribution, and is available at
# http://www.apache.org/licenses/LICENSE-2.0
########################################################################

########################################################################
# This Blueprint deploy the clearwater IMS on an openstack environment
########################################################################

tosca_definitions_version: cloudify_dsl_1_3

imports:
  - openstack-blueprint.yaml

inputs:

  end_number:
    type: string
    description: 2010000000 to ? 2010049999 ?
    default: 2010049999

node_templates:

  one_vellum_host:
    type: cloudify.nodes.Compute
    properties:
      install_agent: true
      ip: { get_attribute: [vellum_host, ip] }
      cloudify_agent:
        user: { get_input: agent_user }
        key: /root/ssh/agent.key

  vellum_provisioning:
    type: clearwater.nodes.vellum.provisioning
    properties:
      public_domain: { get_input: public_domain }
      end_number: { get_input: end_number }
    relationships:
      - type: cloudify.relationships.contained_in
        target: one_vellum_host
      - type: cloudify.relationships.connected_to
        target: vellum
